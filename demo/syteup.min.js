"use strict";function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function formatModuleName(module){return module.replace(/_(.)/g,function(match,p1){return p1.toUpperCase()})}function formatModulePath(module){return module.replace(/_(.)/g,function(match,p1){return"-"+p1})}function alertError(error,errorMessage){return asyncText("templates/alert.html").then(function(view){var template=Handlebars.compile(view);return $(template({error:error,error_message:errorMessage})).modal().on("hidden.bs.modal",function(){$(this).remove()}),Promise.resolve()})}function asyncText(url,headers){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;if(xhr.open("GET",url,!1),xhr.overrideMimeType&&xhr.overrideMimeType("text/plain"),xhr.onload=function(){return 200!==this.status?void reject(this.status):void resolve(this.responseText)},xhr.onerror=function(){reject()},headers)for(var header in headers)headers.hasOwnProperty(header)&&xhr.setRequestHeader(header,headers[header]);xhr.send()})}function asyncGet(url,headers,jsonp){return headers?asyncText(url,headers).then(function(res){return Promise.resolve(JSON.parse(res))}):new Promise(function(resolve,reject){$.ajax({url:url,jsonp:jsonp,contentType:"application/json; charset=utf-8",type:"GET",dataType:"jsonp",async:!1,success:function(res){"meta"in res&&2===Object.keys(res).length&&("data"in res?res=res.data:"response"in res&&(res=res.response)),resolve(res)},error:function(xhr,status){reject(status)}})})}function loadJS(src,obj,data,parentEl){return new Promise(function(resolve){function onload(){this.removeEventListener("load",onload),this.removeEventListener("loadend",onload),this.removeEventListener("afterscriptexecute",onload),resolve()}var script=document.createElement("script");if(script.type="text/javascript",script.async=!0,script.src=src.replace(/^\/\//,"https:"===document.location.protocol?"https://":"http://"),obj)for(var opt in obj)obj.hasOwnProperty(opt)&&(script[opt]=obj[opt]);if(data)for(var el in data)data.hasOwnProperty(el)&&(script.dataset[el]=data[el]);script.addEventListener("load",onload),script.addEventListener("loadend",onload),script.addEventListener("afterscriptexecute",onload),(parentEl||document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(script)})}function exportM(obj,name){"undefined"!=typeof module&&module.export?module.export[name]=obj:"function"==typeof define&&define.amd?define(name,function(){return obj}):window[name]=obj}function exportBlog(blog,name){exportM(blog,formatModuleName(name)+"Blog")}function exportService(service,name){exportM(service,formatModuleName(name)+"Service")}function exportPlugin(plugin,name){exportM(plugin,formatModuleName(name)+"Plugin")}function importM(name,path){return new Promise(function(resolve){if(window[name])resolve(window[name]);else if("function"==typeof define&&define.amd)require([path],function(_){resolve(_[name],_)});else if("undefined"!=typeof module&&module.exports){var _module=require(path);resolve(_module[name]||_module)}else loadJS(path+".js").then(function(){resolve(window[name])})})}function setupBlog(settings){return registerPostLinkClick(settings),registerTagLinkClick(settings),registerHomeItemClick(settings),window.sharethis_enabled=settings.blogs_settings.plugins.sharethis||!1,settings.blogs_settings.plugins.disqus&&importM("disqusPlugin","plugins/disqus").then(function($plugin){$plugin.setup(settings.plugins_settings.disqus)}),window.reachedEnd=!1,"#!post/"===location.hash.substr(0,7)?postsOpts={id:location.hash.slice(7).split("#")[0]}:"#!tag/"===location.hash.substr(0,6)&&(postsOpts={tag:location.hash.slice(6).split("#")[0]}),fetchBlogPosts(0,settings.blogs_settings[settings.blog_platform],settings.blog_platform,postsOpts).then(function(offset){return postOffset=offset,window.sharethis_enabled&&importM("sharethisPlugin","plugins/sharethis").then(function($plugin){$plugin.setup(settings.plugins_settings.sharethis)}),Promise.resolve()})}function registerPostLinkClick(settings){$(document).on("click",".post-link",function(){this.dataset.id&&(postsOpts={id:this.dataset.id},fetchBlogPosts(0,settings.blogs_settings[settings.blog_platform],settings.blog_platform,postsOpts)),postOffset=0})}function registerTagLinkClick(settings){$(document).on("click",".tag-link",function(){this.textContent&&(window.reachedEnd=!1,postsOpts={tag:this.textContent},fetchBlogPosts(0,settings.blogs_settings[settings.blog_platform],settings.blog_platform,postsOpts).then(function(offset){postOffset=offset}))})}function registerHomeItemClick(settings){$("#home-item-link").on("click",function(){"#!"===location.hash.substr(0,2)&&(location.hash="",postsOpts=void 0,window.reachedEnd=!1,fetchBlogPosts(0,settings.blogs_settings[settings.blog_platform],settings.blog_platform).then(function(offset){postOffset=offset}))})}function registerScroll(settings){var resultsLoaded=!1,scrollWait=!1,scrollWaitDur=250;$(window).scroll(function(){!window.reachedEnd&&!resultsLoaded&&!scrollWait&&postOffset&&$(window).scrollTop()+$(window).height()>$(document).height()/1.2&&(resultsLoaded=!0,scrollWait=!0,fetchBlogPosts(postOffset,settings.blogs_settings[settings.blog_platform],settings.blog_platform,postsOpts).then(function(offset){postOffset=offset,scrollWait=!1}),setTimeout(function(){scrollWait=!1},scrollWaitDur)),resultsLoaded&&$(window).scrollTop()+$(window).height()<$(document).height()/1.2&&(resultsLoaded=!1)})}function renderBlogPosts(posts,clearPosts){0===posts.length&&(window.reachedEnd=!0),Promise.all([asyncText("templates/blog-post-text.html"),asyncText("templates/blog-post-photo.html"),asyncText("templates/blog-post-link.html"),asyncText("templates/blog-post-video.html"),asyncText("templates/blog-post-audio.html"),asyncText("templates/blog-post-quote.html")]).then(function(res){var text_template=Handlebars.compile(res[0]),photo_template=Handlebars.compile(res[1]),link_template=Handlebars.compile(res[2]),video_template=Handlebars.compile(res[3]),audio_template=Handlebars.compile(res[4]),quote_template=Handlebars.compile(res[5]);$(".loading").remove(),clearPosts&&$("#blog-posts").empty(),1===posts.length&&window.disqus_enabled&&(posts[0].disqus_open=!0),posts=posts.forEach(function(p){if(p.formated_date=moment.utc(p.date,"YYYY-MM-DD HH:mm:ss").local().format("MMMM DD, YYYY"),window.disqus_enabled&&(p.disqus_enabled=!0),p.disqus_just_count=window.disqus_just_count,"text"===p.type){var idx=p.body.indexOf("<!-- more -->");idx>0&&(p.body=p.body.substring(0,idx),p.show_more=!0),$("#blog-posts").append(text_template(p))}else"photo"===p.type?$("#blog-posts").append(photo_template(p)):"link"===p.type?$("#blog-posts").append(link_template(p)):"video"===p.type?$("#blog-posts").append(video_template(p)):"audio"===p.type?$("#blog-posts").append(audio_template(p)):"quote"===p.type&&$("#blog-posts").append(quote_template(p))}),prettyPrint(),setTimeout(setupBlogHeaderScroll,1e3),adjustSelection("home"),document.body.dispatchEvent(new CustomEvent("blog-post-loaded"))})}function fetchBlogPosts(offset,settings,platform,posts_options){return posts_options&&posts_options.id&&(window.reachedEnd=!0),importM(formatModuleName(platform)+"Blog","blogs/"+formatModulePath(platform)).then(function($blog){if(!$blog)return Promise.reject(MODULE_NOT_FOUND);var posts;return posts=posts_options&&posts_options.id?$blog.fetchPost(settings,posts_options.id):posts_options&&posts_options.tag?offset?$blog.fetchTagMore(settings,posts_options.tag):$blog.fetchTag(settings,posts_options.tag):offset?$blog.fetchMore(settings):$blog.fetch(settings),posts.then(function(data){return data&&0!==data.length?(renderBlogPosts(data,posts_options&&posts_options.id||!offset),Promise.resolve(!0)):Promise.resolve(!1)}).catch(function(error){return alertError(error),Promise.resolve(!1)})})}function setupBlogHeaderScroll(){if(!window.isMobileView){$(".blog-section article hgroup h3 a").click(function(e){this.hash&&($("html, body").stop().animate({scrollTop:$(this.hash).offset().top},500,"linear"),e.preventDefault())});var dateHeight=$("#blog-posts article hgroup h3 a")[0].scrollHeight;$(window).scroll(function(){window.scrollY;$("#blog-posts article").each(function(){this.className=window.scrollY<this.offsetTop?"":window.scrollY>this.offsetTop+this.scrollHeight-dateHeight?"passed":"current"})})}}function setupLinks(settings){allComponents=Object.keys(settings.services),allComponents.forEach(function(service){settings.services[service]&&enabledServices.push(service)}),"object"==typeof settings.fields.contact&&(enabledServices.push("syteup_contact"),settings.services_settings.syteup_contact=settings.fields.contact,settings.services_settings.syteup_contact.url="mailto:"+settings.fields.contact.email);var main_nav=document.getElementsByClassName("main-nav")[0];main_nav.innerHTML="",settings.blog_platform.length&&addLinkItem(main_nav,"/","home-item-link","Home");var i;for(i=0;i<enabledServices.length;i++){var text,service=enabledServices[i],$service=window[formatModuleName(service)+"Service"];text=$service?$service.displayName:service[0].toUpperCase()+service.slice(1),addLinkItem(main_nav,settings.services_settings[service].url,service+"-item-link",text)}"string"==typeof settings.fields.contact&&addLinkItem(main_nav,"mailto:"+settings.fields.contact+"?subject=Hello","contact-item-link","Contact"),linkClickHandler(settings)}function addLinkItem(main_nav,href,id,text){var li,link;li=document.createElement("li"),link=document.createElement("a"),link.href=href,link.id=id,link.textContent=text,li.appendChild(link),main_nav.appendChild(li)}function linkClickHandler(settings){$(".main-nav a").click(function(e){if(2!==e.which&&(e.preventDefault(),e.stopPropagation(),this.href!==$url)){if($url=this.href,"home-item-link"===this.id)return void adjustSelection("home");var i;for(i=0;i<enabledServices.length;i++){var service=enabledServices[i];if(this.id===service+"-item-link")return void adjustSelection(service,setupService.bind(this,service,$url,this,settings.services_settings[service]))}window.location=this.href}})}function adjustSelection(component,callback){var transition,$currProfileEl;"home"!==currSelection?($currProfileEl=$("#"+currSelection+"-profile"),transition=$.support.transition&&$currProfileEl.hasClass("fade"),$currProfileEl.modal("hide"),callback&&(transition?$currProfileEl.one($.support.transition.end,callback):callback())):callback&&callback(),$(".main-nav").children("li").removeClass("sel"),$("#"+component+"-item-link").parent().addClass("sel"),"home"===component&&($url=null),window.currSelection=component}function setupPlugins(settings){return Promise.all(pluginsPromises(settings))}function pluginsPromises(settings){return Object.keys(settings.plugins).filter(function(plugin){return settings.plugins[plugin]}).map(function(plugin){return setupPlugin(plugin,settings.plugins_settings[plugin]).then(console.log.bind(console,"Plugin Setuped:",plugin)).catch(console.error.bind(console,"Plugin Not Found",plugin))})}function setupPlugin(plugin,settings){return new Promise(function(resolve,reject){importM(formatModuleName(plugin)+"Plugin","plugins/"+formatModulePath(plugin)).then(function($plugin){$plugin?($plugin.setup(settings),resolve()):reject(MODULE_NOT_FOUND)})})}function setupService(service,url,el,settings){return importM(formatModuleName(service)+"Service","services/"+formatModulePath(service)).then(function($service){var href=el.href;if($("#"+service+"-profile").length>0)return void(window.location=href);if(!$service)return console.error("Service Not Found:",service),void(window.location=href);var spinner=new Spinner(spin_opts).spin();$("#"+service+"-item-link").append(spinner.el);var promises=[$service.fetch(settings),asyncText("templates/"+$service.template)];return $service.supportMore&&promises.push(asyncText("templates/"+$service.templateMore)),Promise.all(promises).then(function(results){var $modal,serviceData=results[0],view=results[1],viewMore=results[2];if(!serviceData||serviceData.error)return void(window.location=href);var template=Handlebars.compile(view);if(serviceData=$service.setup(serviceData,settings),!serviceData)return void(window.location=href);if($modal=$(template(serviceData)).modal().on("hidden.bs.modal",function(){$(this).remove(),currSelection===service&&adjustSelection("home")}),$service.supportMore){var moreTemplate=Handlebars.compile(viewMore);$modal.find("#load-more-data").click(function(){var spinnerMore=new Spinner(spin_opts).spin();$(this).append(spinnerMore.el),$service.fetchMore(settings).then(function(serviceMoreData){serviceMoreData=$service.setupMore(serviceMoreData,settings),$("."+service+" .profile-data").append(moreTemplate(serviceMoreData)),spinnerMore.stop()}).catch(function(error){error===NO_MORE_DATA&&$(this).remove(),spinnerMore.stop()})})}spinner.stop(),console.info("Service Setuped:",service)}).catch(function(error){alertError(error),console.error("Service Not Setuped:",service)})})}window.UNKNOWN_ERROR=-1,window.NO_MORE_DATA=-2,window.MODULE_NOT_FOUND=-3,window.spin_opts={lines:9,length:5,width:2,radius:4,rotate:9,color:"#4c4c4c",speed:1.5,trail:40,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,left:"90%"};var postOffset,postsOpts,$url,allComponents=[],enabledServices=[];window.currSelection="home",asyncGet("config.json",{}).then(function(settings){document.getElementById("field-realname").textContent=settings.fields.realname,document.getElementById("field-description").textContent=settings.fields.description,document.getElementById("field-url").textContent=settings.fields.url,document.head.getElementsByTagName("title")[0].textContent=settings.fields.username+" ["+settings.fields.realname+"]",document.head.getElementsByTagName("meta")[0].content=settings.fields.realname+" : "+settings.fields.description,settings.services.flickr&&(window.flickr_id=settings.services_settings.flickr.id),settings.services.tent&&(window.tent_entity_uri=settings.services_settings.tent.entity_uri,window.tent_feed_uri=settings.services_settings.tent.feed_url),$(function(){new Promise(function(resolve){setupLinks(settings),resolve()}).then(setupBlog(settings)).then(setupPlugins(settings))})}).catch(function(error){console.error("ERROR: Main Promise Rejected! To bad to break a vow"),alertError(error).catch(function(){alert("ERROR! "+error)})});var isMobileView=!1;if("undefined"!=typeof window.matchMedia){var mediaQuery=window.matchMedia("(max-width:799px)");mediaQuery.matches&&(isMobileView=!0)}$(function(){$("#mobile-nav-btn").click(function(){$(".main-section").toggleClass("nav-opened")})}),function(window){function getPosts(settings,postId,tag,offset){var params="?maxResults=20&key="+settings.api_key+"&fields=items(content%2Cid%2Clabels%2Cpublished%2Ctitle%2Curl)%2CnextPageToken";return offset&&nextId&&(params+="&pageToken="+nextId),tag?params+="&labels="+tag:settings.tag_slug&&(params+="&labels="+tag),postId&&(params="/"+postId+"?key="+settings.api_key+"&content%2Cid%2Clabels%2Cpublished%2Ctitle%2Curl"),asyncGet(API_URL+"blogs/"+settings.blog_id+"/posts"+params).then(function(res){return res.error?(window.reachedEnd=!0,Promise.resolve([])):(nextId=res.nextPageToken,nextId||(window.reachedEnd=!0),postId&&(res={items:[res]}),res.items.forEach(function(post){post.date=post.published,post.body=post.content,post.tags=post.labels,post.tags=post.labels,post.type="text"}),Promise.resolve(res.items))})}function fetchPosts(settings){return nextId="",getPosts(settings,void 0,void 0,!1)}function fetchMorePosts(settings){return getPosts(settings,void 0,void 0,!0)}function fetchOnePost(settings,postId){return nextId="",getPosts(settings,postId,void 0,!1)}function fetchBlogTag(settings,tag){return nextId="",getPosts(settings,void 0,tag,!1)}function fetchBlogTagMore(settings,tag){return getPosts(settings,void 0,tag,!0)}var API_URL="https://www.googleapis.com/blogger/v3/",nextId=0;exportBlog({fetch:fetchPosts,fetchMore:fetchMorePosts,fetchPost:fetchOnePost,fetchTag:fetchBlogTag,fetchTagMore:fetchBlogTagMore},"blogger")}(window);